
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Using intake-esgf with rooki &#8212; My Jupyter Book</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.4cbf315f70debaebd550c87a6162cf0f.min.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script src="../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Compute Demo: ENSO nonlinearity index with CMIP6 data" href="rooki_enso_nonlinear.html" />
    <link rel="prev" title="Compute Demo: Use Rooki to access CMIP6 data" href="rooki.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">My Jupyter Book</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../README.html">
   ESGF Cookbook
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Preamble
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="how-to-cite.html">
   How to Cite This Cookbook
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="running-on-nimbus.html">
   Running Notebooks on Nimbus
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Searching
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro-search.html">
   Introduction to
   <code class="docutils literal notranslate">
    <span class="pre">
     intake-esgf
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="complex-search.html">
   Complex Searching with
   <code class="docutils literal notranslate">
    <span class="pre">
     intake-esgf
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rooki.html">
   Compute Demo: Use Rooki to access CMIP6 data
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Using intake-esgf with rooki
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Workflows
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="rooki_enso_nonlinear.html">
   Compute Demo: ENSO nonlinearity index with CMIP6 data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ex-regrid-plot.html">
   Demo: Regridding and Plotting with Rooki and Cartopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="complex-search2-and-analysis.html">
   Complex Searching with
   <code class="docutils literal notranslate">
    <span class="pre">
     intake
    </span>
   </code>
   and analysing employing
   <code class="docutils literal notranslate">
    <span class="pre">
     xarray
    </span>
   </code>
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/notebooks/use-intake-esgf-with-rooki.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overview">
   Overview
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prerequisites">
   Prerequisites
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#imports">
   Imports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#search-and-find-data-for-surface-temperature-on-the-ornl-node">
   Search and Find Data for Surface Temperature on the ORNL Node
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-the-index-node-and-search">
     Set the Index Node and Search
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#extract-ids-to-pass-to-rooki">
   Extract IDs to Pass to Rooki
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compute-with-rooki">
     Compute with Rooki
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualize-the-output">
   Visualize the Output
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   Summary
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-s-next">
     What’s next?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#resources-and-references">
   Resources and references
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Using intake-esgf with rooki</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overview">
   Overview
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prerequisites">
   Prerequisites
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#imports">
   Imports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#search-and-find-data-for-surface-temperature-on-the-ornl-node">
   Search and Find Data for Surface Temperature on the ORNL Node
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-the-index-node-and-search">
     Set the Index Node and Search
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#extract-ids-to-pass-to-rooki">
   Extract IDs to Pass to Rooki
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compute-with-rooki">
     Compute with Rooki
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualize-the-output">
   Visualize the Output
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   Summary
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-s-next">
     What’s next?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#resources-and-references">
   Resources and references
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <p><img src="images/intake-rooki-demo.png" width=500 alt="Intake Rooki Demo"></img></p>
<hr class="docutils" />
<div class="tex2jax_ignore mathjax_ignore section" id="using-intake-esgf-with-rooki">
<h1>Using intake-esgf with rooki<a class="headerlink" href="#using-intake-esgf-with-rooki" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>In this notebook we will demonstrate how to use intake-esgf and rooki to perform server-side operations and return the result to the user. This will occur in several steps.</p>
<ol class="arabic simple">
<li><p>We use intake-esgf to find data which is local to the ORNL server and then form an id which rooki uses to load the data remotely.</p></li>
<li><p>We build a rooki workflow which uses these ids (<code class="docutils literal notranslate"><span class="pre">rooki_id</span></code>) to subset and average the data remotely.</p></li>
<li><p>The results are downloaded locally and we visualize them interactively using hvplot.</p></li>
</ol>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Concepts</p></th>
<th class="head"><p>Importance</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="intro-search.html"><span class="doc std std-doc">Intro to Intake-ESGF</span></a></p></td>
<td><p>Necessary</p></td>
<td><p>How to configure a search and use output</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="rooki.html"><span class="doc std std-doc">Intro to Rooki</span></a></p></td>
<td><p>Helpful</p></td>
<td><p>How to initialize and run rooki</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://hvplot.holoviz.org/user_guide/Geographic_Data.html">Intro to hvPlot</a></p></td>
<td><p>Necessary</p></td>
<td><p>How to plot interactive visualizations</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p><strong>Time to learn</strong>: 30 minutes</p></li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">¶</a></h2>
<p>Before importing rooki, we need to set an environment variable that will signal the rooki client to use the web processing service (WPS) deployment located at Oak Ridge National Lab (ORNL).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="c1"># Configuration line to set the wps node - in this case, use ORNL in the USA</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://esgf-node.ornl.gov/wps&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;ROOK_URL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">url</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">rooki</span><span class="w"> </span><span class="kn">import</span> <span class="n">operators</span> <span class="k">as</span> <span class="n">ops</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rooki</span><span class="w"> </span><span class="kn">import</span> <span class="n">rooki</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>

  <span class="n">File</span> <span class="o">~/</span><span class="n">micromamba</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">esgf</span><span class="o">-</span><span class="n">cookbook</span><span class="o">-</span><span class="n">dev</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">IPython</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">interactiveshell</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">3672</span> <span class="ow">in</span> <span class="n">run_code</span>
    <span class="n">exec</span><span class="p">(</span><span class="n">code_obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_global_ns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_ns</span><span class="p">)</span>

  <span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">7</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">rooki</span><span class="w"> </span><span class="kn">import</span> <span class="n">operators</span> <span class="k">as</span> <span class="n">ops</span>

  <span class="n">File</span> <span class="o">~/</span><span class="n">micromamba</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">esgf</span><span class="o">-</span><span class="n">cookbook</span><span class="o">-</span><span class="n">dev</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">rooki</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">10</span>
    <span class="n">rooki</span> <span class="o">=</span> <span class="n">Rooki</span><span class="p">()</span>

  <span class="n">File</span> <span class="o">~/</span><span class="n">micromamba</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">esgf</span><span class="o">-</span><span class="n">cookbook</span><span class="o">-</span><span class="n">dev</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">rooki</span><span class="o">/</span><span class="n">client</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">44</span> <span class="ow">in</span> <span class="fm">__init__</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Rooki</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>

  <span class="n">File</span> <span class="o">~/</span><span class="n">micromamba</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">esgf</span><span class="o">-</span><span class="n">cookbook</span><span class="o">-</span><span class="n">dev</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">birdy</span><span class="o">/</span><span class="n">client</span><span class="o">/</span><span class="n">base</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">147</span> <span class="ow">in</span> <span class="fm">__init__</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_wps</span><span class="o">.</span><span class="n">getcapabilities</span><span class="p">(</span><span class="n">xml</span><span class="o">=</span><span class="n">caps_xml</span><span class="p">)</span>

  <span class="n">File</span> <span class="o">~/</span><span class="n">micromamba</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">esgf</span><span class="o">-</span><span class="n">cookbook</span><span class="o">-</span><span class="n">dev</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">owslib</span><span class="o">/</span><span class="n">wps</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">278</span> <span class="ow">in</span> <span class="n">getcapabilities</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_capabilities</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readFromUrl</span><span class="p">(</span>

  <span class="n">File</span> <span class="o">~/</span><span class="n">micromamba</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">esgf</span><span class="o">-</span><span class="n">cookbook</span><span class="o">-</span><span class="n">dev</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">owslib</span><span class="o">/</span><span class="n">wps</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">547</span> <span class="ow">in</span> <span class="n">readFromUrl</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readFromUrl</span><span class="p">(</span><span class="n">url</span><span class="p">,</span>

  <span class="n">File</span> <span class="o">~/</span><span class="n">micromamba</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">esgf</span><span class="o">-</span><span class="n">cookbook</span><span class="o">-</span><span class="n">dev</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">owslib</span><span class="o">/</span><span class="n">wps</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">507</span> <span class="ow">in</span> <span class="n">_readFromUrl</span>
    <span class="k">return</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

  <span class="n">File</span> <span class="n">src</span><span class="o">/</span><span class="n">lxml</span><span class="o">/</span><span class="n">etree</span><span class="o">.</span><span class="n">pyx</span><span class="p">:</span><span class="mi">3307</span> <span class="ow">in</span> <span class="n">lxml</span><span class="o">.</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span>

  <span class="n">File</span> <span class="n">src</span><span class="o">/</span><span class="n">lxml</span><span class="o">/</span><span class="n">parser</span><span class="o">.</span><span class="n">pxi</span><span class="p">:</span><span class="mi">1995</span> <span class="ow">in</span> <span class="n">lxml</span><span class="o">.</span><span class="n">etree</span><span class="o">.</span><span class="n">_parseMemoryDocument</span>

  <span class="n">File</span> <span class="n">src</span><span class="o">/</span><span class="n">lxml</span><span class="o">/</span><span class="n">parser</span><span class="o">.</span><span class="n">pxi</span><span class="p">:</span><span class="mi">1882</span> <span class="ow">in</span> <span class="n">lxml</span><span class="o">.</span><span class="n">etree</span><span class="o">.</span><span class="n">_parseDoc</span>

  <span class="n">File</span> <span class="n">src</span><span class="o">/</span><span class="n">lxml</span><span class="o">/</span><span class="n">parser</span><span class="o">.</span><span class="n">pxi</span><span class="p">:</span><span class="mi">1164</span> <span class="ow">in</span> <span class="n">lxml</span><span class="o">.</span><span class="n">etree</span><span class="o">.</span><span class="n">_BaseParser</span><span class="o">.</span><span class="n">_parseDoc</span>

  <span class="n">File</span> <span class="n">src</span><span class="o">/</span><span class="n">lxml</span><span class="o">/</span><span class="n">parser</span><span class="o">.</span><span class="n">pxi</span><span class="p">:</span><span class="mi">633</span> <span class="ow">in</span> <span class="n">lxml</span><span class="o">.</span><span class="n">etree</span><span class="o">.</span><span class="n">_ParserContext</span><span class="o">.</span><span class="n">_handleParseResultDoc</span>

  <span class="n">File</span> <span class="n">src</span><span class="o">/</span><span class="n">lxml</span><span class="o">/</span><span class="n">parser</span><span class="o">.</span><span class="n">pxi</span><span class="p">:</span><span class="mi">743</span> <span class="ow">in</span> <span class="n">lxml</span><span class="o">.</span><span class="n">etree</span><span class="o">.</span><span class="n">_handleParseResult</span>

  <span class="n">File</span> <span class="n">src</span><span class="o">/</span><span class="n">lxml</span><span class="o">/</span><span class="n">parser</span><span class="o">.</span><span class="n">pxi</span><span class="p">:</span><span class="mi">672</span> <span class="ow">in</span> <span class="n">lxml</span><span class="o">.</span><span class="n">etree</span><span class="o">.</span><span class="n">_raiseParseError</span>

  <span class="n">File</span> <span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">29</span>
<span class="ne">XMLSyntaxError</span>: EntityRef: expecting &#39;;&#39;, line 29, column 46
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Other imports</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">holoviews</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">hv</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hvplot.xarray</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">intake_esgf</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">panel</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pn</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">intake_esgf</span><span class="w"> </span><span class="kn">import</span> <span class="n">ESGFCatalog</span>

<span class="n">hv</span><span class="o">.</span><span class="n">extension</span><span class="p">(</span><span class="s2">&quot;bokeh&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="search-and-find-data-for-surface-temperature-on-the-ornl-node">
<h2>Search and Find Data for Surface Temperature on the ORNL Node<a class="headerlink" href="#search-and-find-data-for-surface-temperature-on-the-ornl-node" title="Permalink to this headline">¶</a></h2>
<p>Let’s start with refining which index we would like to search from. For this analysis, we are remotely computing on the ORNL node since this is where rooki is running. We know this from checking the <code class="docutils literal notranslate"><span class="pre">._url</span></code> method of rooki!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rooki</span><span class="o">.</span><span class="n">_url</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="set-the-index-node-and-search">
<h3>Set the Index Node and Search<a class="headerlink" href="#set-the-index-node-and-search" title="Permalink to this headline">¶</a></h3>
<p>Because we are using the ORNL-based WPS, we only need information about ORNL holdings. So here we configure intake-esgf to only look at the ORNL index for data information.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">intake_esgf</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">indices</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;anl-dev&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                              <span class="s2">&quot;ornl-dev&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<p>Now we instantiate the catalog and perform a search for surface air temperature (tas) data from a few institution’s models. Note that we have also included specificity of the data node. The ORNL index contains information about holdings beyond the ORNL data node and so we give this to force the catalog to only return information about holdings which are local to ORNL.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">=</span> <span class="n">ESGFCatalog</span><span class="p">()</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
    <span class="n">experiment_id</span><span class="o">=</span><span class="s2">&quot;historical&quot;</span><span class="p">,</span>
    <span class="n">variable_id</span><span class="o">=</span><span class="s2">&quot;tas&quot;</span><span class="p">,</span>
    <span class="n">member_id</span><span class="o">=</span><span class="s2">&quot;r1i1p1f1&quot;</span><span class="p">,</span>
    <span class="n">table_id</span><span class="o">=</span><span class="s2">&quot;Amon&quot;</span><span class="p">,</span>
    <span class="n">institution_id</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;MIROC&quot;</span><span class="p">,</span> <span class="s2">&quot;NCAR&quot;</span><span class="p">,</span> <span class="s2">&quot;NASA-GISS&quot;</span><span class="p">,</span> <span class="s2">&quot;CMCC&quot;</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">cat</span><span class="o">.</span><span class="n">df</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="extract-ids-to-pass-to-rooki">
<h2>Extract IDs to Pass to Rooki<a class="headerlink" href="#extract-ids-to-pass-to-rooki" title="Permalink to this headline">¶</a></h2>
<p>The catalog returns a lot of information about the datasets that were found, but the rooki WPS interface just needs an ID that looks similar to what we find in the <code class="docutils literal notranslate"><span class="pre">id</span></code> column of the dataframe. We need to remove the <code class="docutils literal notranslate"><span class="pre">|esgf-node.ornl.gov</span></code> on the end and prepend a <code class="docutils literal notranslate"><span class="pre">ccs03_data</span></code>. To do this we will write a function and apply it to the dataframe.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">build_rooki_id</span><span class="p">(</span><span class="n">id_list</span><span class="p">):</span>
    <span class="n">rooki_id</span> <span class="o">=</span> <span class="n">id_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">rooki_id</span> <span class="o">=</span> <span class="n">rooki_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">rooki_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;css03_data.</span><span class="si">{</span><span class="n">rooki_id</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># &lt;-- just something you have to know for now :(</span>
    <span class="k">return</span> <span class="n">rooki_id</span>

<span class="n">rooki_ids</span> <span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">build_rooki_id</span><span class="p">)</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
<span class="n">rooki_ids</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="compute-with-rooki">
<h3>Compute with Rooki<a class="headerlink" href="#compute-with-rooki" title="Permalink to this headline">¶</a></h3>
<p>Now that we have a list of IDs to pass to rooki, let’s compute! In our case we are interested in the annual temperature from 1990-2000 over an area that includes India (latitude from 0 to 35, longitude from 65 to 100). The following function will construct a rooki workflow that uses operators (functions in the <code class="docutils literal notranslate"><span class="pre">ops</span></code> namespace) that rooki uses to:</p>
<ul class="simple">
<li><p>read in data (<code class="docutils literal notranslate"><span class="pre">ops.Input</span></code>)</p></li>
<li><p>subset in time and space (<code class="docutils literal notranslate"><span class="pre">ops.Subset</span></code>), and</p></li>
<li><p>average in time (<code class="docutils literal notranslate"><span class="pre">ops.AverageByTime</span></code>) on a yearly frequency.</p></li>
</ul>
<p>We then check to make sure the response is okay, and if it is, return the processed dataset to the user! If something went wrong, the function will raise an error and show you the message that rooki sent back.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">india_annual_temperature</span><span class="p">(</span><span class="n">rooki_id</span><span class="p">):</span>
    <span class="n">workflow</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">AverageByTime</span><span class="p">(</span>
        <span class="n">ops</span><span class="o">.</span><span class="n">Subset</span><span class="p">(</span>
            <span class="n">ops</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="s2">&quot;tas&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">rooki_id</span><span class="p">]),</span>
            <span class="n">time</span><span class="o">=</span><span class="s2">&quot;1990-01-01/2000-01-01&quot;</span><span class="p">,</span>
            <span class="n">area</span><span class="o">=</span><span class="s2">&quot;65,0,100,35&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;year&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">orchestrate</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">datasets</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s test a single rooki_id to demonstrate successful functionality. The rooki_id let’s the WPS know on which dataset we are intersted in operating and then the data is loaded remotely, subset, and then averaged. After this computation is finished on the server, the result is transferred to you and loaded into a xarray dataset. Inspect the dataset header to see that there are 10 times, one for each year and the latitude and longitude range spans our input values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">india_annual_temperature</span><span class="p">(</span><span class="n">rooki_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Now that we have some confidence in our workflow function, we can iterate over rooki_id’s running for each and saving into a dictionary whose keys are the different models. You should see messages print to the screen which inform you where the temporary output is being downloaded. This location can be configured in rooki, but for now we will just load them into datasets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dsd</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">rooki_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">india_annual_temperature</span><span class="p">(</span><span class="n">rooki_id</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rooki_id</span> <span class="ow">in</span> <span class="n">rooki_ids</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="visualize-the-output">
<h2>Visualize the Output<a class="headerlink" href="#visualize-the-output" title="Permalink to this headline">¶</a></h2>
<p>Let’s use hvPlot to visualize. The datasets are stored in a dictionary of datasets, we need to:</p>
<ul class="simple">
<li><p>Extract a single key</p></li>
<li><p>Plot a contour filled visualization, with some geographic features</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tas</span> <span class="o">=</span> <span class="n">dsd</span><span class="p">[</span><span class="s2">&quot;MIROC6&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tas</span>
<span class="n">tas</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;lon&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;lat&quot;</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Reds&quot;</span><span class="p">,</span>
    <span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">clim</span><span class="o">=</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="mi">320</span><span class="p">),</span>
    <span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;land&quot;</span><span class="p">,</span> <span class="s2">&quot;ocean&quot;</span><span class="p">],</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
    <span class="n">widget_location</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
    <span class="n">clabel</span><span class="o">=</span><span class="s2">&quot;Yearly Average Temperature (K)&quot;</span><span class="p">,</span>
    <span class="n">geo</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Within this notebook, we learned how to specify a specific index node to search from, pass discovered datasets to rooki, and chain remote-compute with several operations using rooki. We then visualized the output using hvPlot, leading to an interactive plot!</p>
<div class="section" id="what-s-next">
<h3>What’s next?<a class="headerlink" href="#what-s-next" title="Permalink to this headline">¶</a></h3>
<p>More adaptations of the intake-esgf + rooki to remotely compute on ESGF data.</p>
</div>
</div>
<div class="section" id="resources-and-references">
<h2>Resources and references<a class="headerlink" href="#resources-and-references" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://intake-esgf.readthedocs.io/en/latest/">intake-esgf documentation</a></p></li>
<li><p><a class="reference external" href="https://rooki.readthedocs.io/en/latest/">rooki documentation</a></p></li>
<li><p><a class="reference external" href="https://hvplot.holoviz.org/user_guide/Geographic_Data.html">Working with geographic data with hvPlot</a></p></li>
</ul>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="rooki.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Compute Demo: Use Rooki to access CMIP6 data</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="rooki_enso_nonlinear.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Compute Demo: ENSO nonlinearity index with CMIP6 data</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By The Jupyter Book community<br/>
    
        &copy; Copyright 2023.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>